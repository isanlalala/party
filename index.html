<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, orientation=landscape">
    <title>大電視 - Hong Kong Cantonese Party Game</title>
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi5aSn6Zu75opW77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77iP77eP77iP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77eP77e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="大電視">
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5+hHgAHggJ/PchI7wAAAABJRU5ErkJggg==">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        height: 100dvh; overflow: hidden;}

        .screen {
            display: none;
            padding: 20px;
            min-height: 100vh;
            max-height: 100vh;
            overflow-y: auto;
            justify-content: flex-start;
            align-items: center;
            flex-direction: column;
        }

        .screen.active {
            display: flex;
        }

        /* Home Screen */
        .home-screen {
            text-align: center;
            color: white;
        }

        .logo {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 40px;
        }

        .btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .btn:hover, .btn:active {
            background: rgba(255,255,255,0.3);
            transform: scale(0.95);
        }

        /* Setup Screen */
        .setup-screen {
            color: white;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .setup-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .setup-section h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(255,255,255,0.2);
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }

        .checkbox-label {
            flex: 1;
            cursor: pointer;
        }

        .word-count-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.9);
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .timer-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .timer-btn {
            flex: 1;
            min-width: 80px;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timer-btn.selected {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.8);
        }

        /* Game Screen */
		
		
        .game-screen {
            background: #2c3e50;
            color: white;
            position: relative;
            overflow: hidden;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-header {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        .timer {
            font-size: 2rem;
            font-weight: bold;
            color: #e74c3c;
        }

        .score {
            font-size: 1.2rem;
        }

        .game-card {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            height: 100vh;
            padding: 80px 40px 160px;
            position: relative;
            transition: all 0.3s ease;
        }

        .word {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .translation {
            font-size: 1.5rem;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .category {
            font-size: 1rem;
            opacity: 0.6;
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 20px;
        }

        .game-controls {
            position: absolute;
            bottom: 40px;
            left: 20px;
            right: 20px;
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .control-btn {
            flex: 1;
            max-width: 150px;
            padding: 20px;
            border: none;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            text-align: center;
            line-height: 1.2;
        }

        .correct-btn {
            background: rgba(39, 174, 96, 0.8);
            border: 2px solid rgba(39, 174, 96, 0.6);
        }

        .correct-btn:hover, .correct-btn:active {
            background: rgba(39, 174, 96, 1);
            transform: scale(0.95);
        }

        .skip-btn {
            background: rgba(231, 76, 60, 0.8);
            border: 2px solid rgba(231, 76, 60, 0.6);
        }

        .skip-btn:hover, .skip-btn:active {
            background: rgba(231, 76, 60, 1);
            transform: scale(0.95);
        }

        .control-btn small {
            font-size: 0.8rem;
            opacity: 0.9;
            font-weight: normal;
        }

        .swipe-hints {
            position: absolute;
            bottom: 40px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .swipe-hint {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Feedback animations */
        .game-card.correct {
            background: #27ae60 !important;
            animation: correctPulse 0.6s ease;
        }

        .game-card.skip {
            background: #e74c3c !important;
            animation: skipPulse 0.6s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes skipPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.95); }
        }

        /* Results Screen */
        .results-screen {
            color: white;
            text-align: center;
            overflow-y: auto;
            padding: 40px 20px;
        }

        .results-header {
            margin-bottom: 30px;
        }

        .final-score {
            font-size: 3rem;
            font-weight: bold;
            color: #f39c12;
            margin: 10px 0;
        }

        .results-lists {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-category {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .result-category h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .word-list {
            text-align: left;
        }

        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .word-item:last-child {
            border-bottom: none;
        }

        .word-main {
            font-weight: bold;
        }

        .word-trans {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Category Management */
        .category-screen {
            color: white;
            width: 100%;
            max-width: 600px;
            overflow-y: auto;
            padding: 20px;
        }

        .category-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .category-item {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .category-name {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .word-count {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 15px;
            background: rgba(52, 152, 219, 0.8);
            border: 1px solid rgba(52, 152, 219, 0.6);
            color: white;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-small:hover, .btn-small:active {
            background: rgba(52, 152, 219, 1);
            border-color: rgba(52, 152, 219, 0.8);
            transform: scale(0.95);
        }

        .btn-danger {
            background: rgba(231, 76, 60, 0.3);
            border-color: rgba(231, 76, 60, 0.5);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 100%;
            color: #333;
            backdrop-filter: blur(20px);
        }

        .modal-header {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-body {
            margin-bottom: 20px;
        height: 100dvh; overflow: hidden;}

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .exit-btn {
            background: rgba(231, 76, 60, 0.8);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .exit-btn:hover, .exit-btn:active {
            background: rgba(231, 76, 60, 1);
            transform: scale(0.95);
        }

        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Home Screen -->
    <div class="screen active" id="homeScreen">
        <div class="home-screen">
            <div class="logo">大電視</div>
            <div class="subtitle">Hong Kong Cantonese Party Game</div>
            <button class="btn" onclick="showScreen('setupScreen')">開始遊戲 Start Game</button>
            <button class="btn" onclick="showScreen('categoryScreen')">管理詞庫 Manage Categories</button>
        </div>
    </div>

    <!-- Setup Screen -->
    <div class="screen" id="setupScreen">
        <button class="back-btn" onclick="showScreen('homeScreen')">← 返回</button>
        <div class="setup-screen">
            <div class="setup-header">
                <h2>遊戲設定 Game Setup</h2>
            </div>
            
            <div class="setup-section">
                <h3>選擇類別 Select Categories</h3>
                <div id="categoryCheckboxes"></div>
                <div style="margin-top: 10px;">
                    <button class="btn-small" onclick="selectAllCategories()">全選 Select All</button>
                    <button class="btn-small" onclick="deselectAllCategories()">清空 Clear All</button>
                </div>
            </div>

            <div class="setup-section">
                <h3>回合時間 Round Duration</h3>
                <div class="timer-options">
                    <div class="timer-btn" onclick="selectTimer(30)">30秒</div>
                    <div class="timer-btn selected" onclick="selectTimer(60)">60秒</div>
                    <div class="timer-btn" onclick="selectTimer(90)">90秒</div>
                    <div class="timer-btn" onclick="selectTimer(120)">120秒</div>
                </div>
            </div>

            <div class="setup-section">
                <label>
                    <input type="checkbox" id="showTranslation" checked> 顯示英文翻譯 Show English Translation
                </label>
            </div>

            <button class="btn" onclick="startGame()" style="width: 100%; margin-top: 20px;">
                開始遊戲 Start Game
            </button>
        </div>
    </div>

    <!-- Game Screen -->
    <div class="screen" id="gameScreen">
        <div class="game-screen">
                       
            <div class="game-header">
                <button class="exit-btn" onclick="exitGame()">✕ 退出</button>
                <div class="timer" id="gameTimer">60</div>
                <div class="score">
                    <span id="correctCount">0</span> 正確 | <span id="skipCount">0</span> 跳過
                </div>
            </div>


            <div class="game-card" id="gameCard">
                <div class="word" id="currentWord">準備好了嗎？</div>
                <div class="translation" id="currentTranslation">Ready?</div>
                <div class="category" id="currentCategory">香港粵語派對遊戲</div>
            </div>

            <div class="game-controls">
                <button class="control-btn correct-btn" onclick="correctWord()">
                    ✅ 正確<br><small>Correct</small>
                </button>
                <button class="control-btn skip-btn" onclick="skipWord()">
                    ⏩ 跳過<br><small>Skip</small>
                </button>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div class="screen" id="resultsScreen">
        <div class="results-screen">
            <div class="results-header">
                <h2>遊戲結果 Game Results</h2>
                <div class="final-score" id="finalScore">0</div>
                <div>分數 Points</div>
            </div>

            <div class="results-lists">
                <div class="result-category">
                    <h3>✅ 答對了 Correct (<span id="correctResultCount">0</span>)</h3>
                    <div class="word-list" id="correctWordsList"></div>
                </div>

                <div class="result-category">
                    <h3>⬆️ 跳過了 Skipped (<span id="skipResultCount">0</span>)</h3>
                    <div class="word-list" id="skippedWordsList"></div>
                </div>
            </div>

            <button class="btn" onclick="showScreen('setupScreen')">再玩一次 Play Again</button>
            <button class="btn" onclick="showScreen('homeScreen')">回到主頁 Home</button>
        </div>
    </div>

    <!-- Category Management Screen -->
    <div class="screen" id="categoryScreen">
        <button class="back-btn" onclick="showScreen('homeScreen')">← 返回</button>
        <div class="category-screen">
            <h2 style="text-align: center; margin-bottom: 30px;">管理詞庫 Manage Categories</h2>
            
            <button class="btn" onclick="showModal('addCategoryModal')" style="width: 100%; margin-bottom: 20px;">
                ➕ 新增類別 Add Category
            </button>

            <div class="category-list" id="categoryList"></div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" id="addCategoryModal">
        <div class="modal-content">
            <div class="modal-header">新增類別 Add Category</div>
            <div class="modal-body">
                <input type="text" id="newCategoryName" placeholder="類別名稱 Category Name">
            </div>
            <div class="modal-actions">
                <button class="btn-small" onclick="hideModal('addCategoryModal')">取消 Cancel</button>
                <button class="btn-small" onclick="console.log('Add button clicked'); addCategory();">確定 Add</button>
            </div>
        </div>
    </div>

    <!-- Add Word Modal -->
    <div class="modal" id="addWordModal">
        <div class="modal-content">
            <div class="modal-header">新增詞語 Add Word</div>
            <div class="modal-body">
                <input type="text" id="newWord" placeholder="中文詞語 Chinese Word" style="margin-bottom: 10px;">
                <input type="text" id="newTranslation" placeholder="英文翻譯 English Translation">
            </div>
            <div class="modal-actions">
                <button class="btn-small" onclick="hideModal('addWordModal')">取消 Cancel</button>
                <button class="btn-small" onclick="addWord()">確定 Add</button>
            </div>
        </div>
    </div>

    <!-- Edit Category Modal -->
    <div class="modal" id="editCategoryModal">
        <div class="modal-content">
            <div class="modal-header">編輯類別 Edit Category</div>
            <div class="modal-body">
                <input type="text" id="editCategoryName" placeholder="類別名稱 Category Name">
                <div style="margin-top: 20px;">
                    <h4>詞語列表 Word List</h4>
                    <div id="editWordsList"></div>
                </div>
                <button class="btn-small" onclick="showAddWordForm()" style="width: 100%; margin-top: 10px;">
                    ➕ 新增詞語 Add Word
                </button>
            </div>
            <div class="modal-actions">
                <button class="btn-small" onclick="hideModal('editCategoryModal')">取消 Cancel</button>
                <button class="btn-small" onclick="saveCategory()">儲存 Save</button>
            </div>
        </div>
    </div>

    <script>
        // Default word packs
        const defaultCategories = {
            "香港名人 HK Celebrities": [
                { word: "張學友", translation: "Jacky Cheung", category: "香港名人 HK Celebrities" },
                { word: "劉德華", translation: "Andy Lau", category: "香港名人 HK Celebrities" },
                { word: "周星馳", translation: "Stephen Chow", category: "香港名人 HK Celebrities" },
                { word: "王菲", translation: "Faye Wong", category: "香港名人 HK Celebrities" },
                { word: "梁朝偉", translation: "Tony Leung", category: "香港名人 HK Celebrities" },
                { word: "陳奕迅", translation: "Eason Chan", category: "香港名人 HK Celebrities" }
            ],
            "香港地點 HK Places": [
                { word: "沙田馬場", translation: "Sha Tin Racecourse", category: "香港地點 HK Places" },
                { word: "太平山頂", translation: "Victoria Peak", category: "香港地點 HK Places" },
                { word: "尖沙咀", translation: "Tsim Sha Tsui", category: "香港地點 HK Places" },
                { word: "中環", translation: "Central", category: "香港地點 HK Places" },
                { word: "銅鑼灣", translation: "Causeway Bay", category: "香港地點 HK Places" },
                { word: "旺角", translation: "Mong Kok", category: "香港地點 HK Places" },
                { word: "迪士尼樂園", translation: "Disneyland", category: "香港地點 HK Places" }
            ],
            "香港美食 HK Food": [
                { word: "茶餐廳", translation: "Cha Chaan Teng", category: "香港美食 HK Food" },
                { word: "點心", translation: "Dim Sum", category: "香港美食 HK Food" },
                { word: "燒鵝", translation: "Roast Goose", category: "香港美食 HK Food" },
                { word: "菠蘿包", translation: "Pineapple Bun", category: "香港美食 HK Food" },
                { word: "奶茶", translation: "Milk Tea", category: "香港美食 HK Food" },
                { word: "雲吞麵", translation: "Wonton Noodles", category: "香港美食 HK Food" },
                { word: "蛋撻", translation: "Egg Tart", category: "香港美食 HK Food" }
            ],
            "粵語俗語 Cantonese Sayings": [
                { word: "得閒飲茶", translation: "Let's have tea when free", category: "粵語俗語 Cantonese Sayings" },
                { word: "好彩", translation: "Lucky", category: "粵語俗語 Cantonese Sayings" },
                { word: "搞掂", translation: "Done/Fixed", category: "粵語俗語 Cantonese Sayings" },
                { word: "冇問題", translation: "No problem", category: "粵語俗語 Cantonese Sayings" },
                { word: "頂癮", translation: "Addictive/Great", category: "粵語俗語 Cantonese Sayings" },
                { word: "勁", translation: "Awesome/Strong", category: "粵語俗語 Cantonese Sayings" }
            ],
            "卡通人物 Cartoon Characters": [
                { word: "多啦A夢", translation: "Doraemon", category: "卡通人物 Cartoon Characters" },
                { word: "比卡超", translation: "Pikachu", category: "卡通人物 Cartoon Characters" },
                { word: "Hello Kitty", translation: "Hello Kitty", category: "卡通人物 Cartoon Characters" },
                { word: "麥兜", translation: "McDull", category: "卡通人物 Cartoon Characters" },
                { word: "櫻桃小丸子", translation: "Chibi Maruko-chan", category: "卡通人物 Cartoon Characters" }
            ]
        };

        // Game state
        let gameState = {
            selectedCategories: [],
            duration: 60,
            showTranslation: true,
            currentWords: [],
            currentWordIndex: 0,
            correctWords: [],
            skippedWords: [],
            timeLeft: 60,
            gameTimer: null,
            touchStartY: 0,
            touchStartTime: 0
        };

        // Initialize the app
        function initApp() {
            // Load default categories if not exists
            if (!localStorage.getItem('categories')) {
                localStorage.setItem('categories', JSON.stringify(defaultCategories));
            }
            
            updateCategorySelect();
            updateCategoryList();
            setupSwipeHandlers();
        }

        // Screen management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        // Modal management
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                console.log('Modal shown:', modalId); // Debug log
            } else {
                console.error('Modal not found:', modalId); // Debug log
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                // Clear form fields
                modal.querySelectorAll('input').forEach(input => input.value = '');
                console.log('Modal hidden:', modalId); // Debug log
            } else {
                console.error('Modal not found:', modalId); // Debug log
            }
        }

        // Timer selection
        function selectTimer(seconds) {
            gameState.duration = seconds;
            document.querySelectorAll('.timer-btn').forEach(btn => btn.classList.remove('selected'));
            event.target.classList.add('selected');
        }

        // Category management
        function updateCategorySelect() {
            console.log('updateCategorySelect called'); // Debug log
            const categories = JSON.parse(localStorage.getItem('categories') || '{}');
            const container = document.getElementById('categoryCheckboxes');
            
            if (!container) {
                console.error('Category checkboxes container not found');
                return;
            }
            
            container.innerHTML = '';
            
            Object.entries(categories).forEach(([categoryName, words]) => {
                const checkboxDiv = document.createElement('div');
                checkboxDiv.className = 'checkbox-item';
                checkboxDiv.innerHTML = `
                    <input type="checkbox" id="cat_${categoryName}" value="${categoryName}" checked onchange="updateSelectedCategories()">
                    <label for="cat_${categoryName}" class="checkbox-label">${categoryName}</label>
                    <span class="word-count-badge">${words.length}</span>
                `;
                container.appendChild(checkboxDiv);
                
                // Make the whole div clickable
                checkboxDiv.addEventListener('click', (e) => {
                    if (e.target.type !== 'checkbox') {
                        const checkbox = checkboxDiv.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                        updateSelectedCategories();
                    }
                });
            });
            
            console.log('Category checkboxes updated with', Object.keys(categories).length, 'categories');
            updateSelectedCategories();
        }

        function selectAllCategories() {
            const checkboxes = document.querySelectorAll('#categoryCheckboxes input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            updateSelectedCategories();
        }

        function deselectAllCategories() {
            const checkboxes = document.querySelectorAll('#categoryCheckboxes input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            updateSelectedCategories();
        }

        function updateSelectedCategories() {
            const selectedCategories = [];
            const checkboxes = document.querySelectorAll('#categoryCheckboxes input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                selectedCategories.push(checkbox.value);
            });
            
            // Store selected categories in game state
            gameState.selectedCategories = selectedCategories;
            
            console.log('Selected categories:', selectedCategories);
        }

        function updateCategoryList() {
            console.log('updateCategoryList called'); // Debug log
            const categories = JSON.parse(localStorage.getItem('categories') || '{}');
            const container = document.getElementById('categoryList');
            
            if (!container) {
                console.error('Category list container not found');
                return;
            }
            
            container.innerHTML = '';
            
            Object.entries(categories).forEach(([categoryName, words]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-item';
                categoryDiv.innerHTML = `
                    <div class="category-header">
                        <div>
                            <div class="category-name">${categoryName}</div>
                            <div class="word-count">${words.length} 個詞語</div>
                        </div>
                        <div>
                            <button class="btn-small" onclick="editCategory('${categoryName}')">編輯</button>
                            <button class="btn-small btn-danger" onclick="deleteCategory('${categoryName}')">刪除</button>
                        </div>
                    </div>
                `;
                container.appendChild(categoryDiv);
            });
            
            console.log('Category list updated with', Object.entries(categories).length, 'categories');
        }

        function addCategory() {
            console.log('addCategory function called'); // Debug log
            const nameInput = document.getElementById('newCategoryName');
            console.log('Input element:', nameInput); // Debug log
            
            if (!nameInput) {
                console.error('Input element not found');
                alert('輸入欄位未找到 Input field not found');
                return;
            }
            
            const name = nameInput.value.trim();
            console.log('Category name:', name); // Debug log
            
            if (!name) {
                console.log('Empty name detected');
                alert('請輸入類別名稱 Please enter category name');
                return;
            }
            
            try {
                console.log('Getting categories from localStorage...');
                const categoriesString = localStorage.getItem('categories');
                console.log('Raw categories string:', categoriesString);
                
                const categories = JSON.parse(categoriesString || '{}');
                console.log('Parsed categories:', categories);
                
                if (categories[name]) {
                    console.log('Category already exists:', name);
                    alert('類別已存在 Category already exists');
                    return;
                }
                
                console.log('Adding new category:', name);
                categories[name] = [];
                
                const newCategoriesString = JSON.stringify(categories);
                console.log('New categories string:', newCategoriesString);
                
                localStorage.setItem('categories', newCategoriesString);
                console.log('Saved to localStorage');
                
                // Verify it was saved
                const savedCategories = localStorage.getItem('categories');
                console.log('Verification - saved categories:', savedCategories);
                
                console.log('Category added successfully'); // This should show now
                
                updateCategorySelect();
                updateCategoryList();
                hideModal('addCategoryModal');
            } catch (error) {
                console.error('Error in addCategory:', error);
                alert('新增類別時發生錯誤 Error adding category: ' + error.message);
            }
        }

        function deleteCategory(categoryName) {
            const shouldDelete = confirm(`確定要刪除「${categoryName}」嗎？\nAre you sure you want to delete "${categoryName}"?`);
            if (shouldDelete) {
                const categories = JSON.parse(localStorage.getItem('categories') || '{}');
                delete categories[categoryName];
                localStorage.setItem('categories', JSON.stringify(categories));
                
                updateCategorySelect();
                updateCategoryList();
            }
        }

        let currentEditingCategory = '';

        function editCategory(categoryName) {
            currentEditingCategory = categoryName;
            const categories = JSON.parse(localStorage.getItem('categories') || '{}');
            const words = categories[categoryName] || [];
            
            document.getElementById('editCategoryName').value = categoryName;
            
            const wordsList = document.getElementById('editWordsList');
            wordsList.innerHTML = '';
            
            words.forEach((wordObj, index) => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-item';
                wordDiv.innerHTML = `
                    <div>
                        <div class="word-main">${wordObj.word}</div>
                        <div class="word-trans">${wordObj.translation}</div>
                    </div>
                    <button class="btn-small btn-danger" onclick="removeWord(${index})">刪除</button>
                `;
                wordsList.appendChild(wordDiv);
            });
            
            showModal('editCategoryModal');
        }

        function saveCategory() {
            const newName = document.getElementById('editCategoryName').value.trim();
            if (!newName) return;
            
            const categories = JSON.parse(localStorage.getItem('categories') || '{}');
            
            if (newName !== currentEditingCategory) {
                // Rename category
                categories[newName] = categories[currentEditingCategory];
                delete categories[currentEditingCategory];
                
                // Update category reference in words
                categories[newName].forEach(word => {
                    word.category = newName;
                });
            }
            
            localStorage.setItem('categories', JSON.stringify(categories));
            updateCategorySelect();
            updateCategoryList();
            hideModal('editCategoryModal');
        }

        function showAddWordForm() {
            hideModal('editCategoryModal');
            showModal('addWordModal');
        }

        function addWord() {
            const word = document.getElementById('newWord').value.trim();
            const translation = document.getElementById('newTranslation').value.trim();
            
            if (!word || !translation) {
                alert('請填寫完整資料 Please fill in all fields');
                return;
            }
            
            if (!currentEditingCategory) {
                alert('請先選擇類別 Please select a category first');
                return;
            }
            
            const categories = JSON.parse(localStorage.getItem('categories') || '{}');
            if (!categories[currentEditingCategory]) {
                categories[currentEditingCategory] = [];
            }
            
            categories[currentEditingCategory].push({
                word: word,
                translation: translation,
                category: currentEditingCategory
            });
            
            localStorage.setItem('categories', JSON.stringify(categories));
            hideModal('addWordModal');
            editCategory(currentEditingCategory); // Refresh the edit modal
        }

        function removeWord(index) {
            const categories = JSON.parse(localStorage.getItem('categories') || '{}');
            categories[currentEditingCategory].splice(index, 1);
            localStorage.setItem('categories', JSON.stringify(categories));
            editCategory(currentEditingCategory); // Refresh the edit modal
        }

        // Game logic
        function startGame() {
    requestFullScreen();
            gameState.showTranslation = document.getElementById('showTranslation').checked;
            gameState.timeLeft = gameState.duration;
            gameState.correctWords = [];
            gameState.skippedWords = [];
            gameState.currentWordIndex = 0;
            
            // Check if any categories are selected
            if (!gameState.selectedCategories || gameState.selectedCategories.length === 0) {
                alert('請至少選擇一個類別 Please select at least one category');
                return;
            }
            
            // Prepare word list from selected categories
            const categories = JSON.parse(localStorage.getItem('categories') || '{}');
            gameState.currentWords = [];
            
            gameState.selectedCategories.forEach(categoryName => {
                if (categories[categoryName]) {
                    gameState.currentWords.push(...categories[categoryName]);
                }
            });
            
            // Shuffle words
            for (let i = gameState.currentWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameState.currentWords[i], gameState.currentWords[j]] = [gameState.currentWords[j], gameState.currentWords[i]];
            }
            
            if (gameState.currentWords.length === 0) {
                alert('所選類別中沒有可用的詞語 No words available in selected categories');
                return;
            }
            
            console.log(`Starting game with ${gameState.currentWords.length} words from ${gameState.selectedCategories.length} categories`);
            
            showScreen('gameScreen');
            displayCurrentWord();
            startTimer();
        }

        function displayCurrentWord() {
            if (gameState.currentWordIndex >= gameState.currentWords.length) {
                gameState.currentWordIndex = 0; // Loop back to start
            }
            
            const currentWord = gameState.currentWords[gameState.currentWordIndex];
            document.getElementById('currentWord').textContent = currentWord.word;
            document.getElementById('currentTranslation').textContent = gameState.showTranslation ? currentWord.translation : '';
            document.getElementById('currentTranslation').style.display = gameState.showTranslation ? 'block' : 'none';
            document.getElementById('currentCategory').textContent = currentWord.category;
            
            // Update score display
            document.getElementById('correctCount').textContent = gameState.correctWords.length;
            document.getElementById('skipCount').textContent = gameState.skippedWords.length;
        }

        function startTimer() {
            const timerDisplay = document.getElementById('gameTimer');
            
            gameState.gameTimer = setInterval(() => {
                gameState.timeLeft--;
                timerDisplay.textContent = gameState.timeLeft;
                
                // Change color when time is running out
                if (gameState.timeLeft <= 10) {
                    timerDisplay.style.color = '#e74c3c';
                    timerDisplay.style.animation = 'pulse 1s infinite';
                } else if (gameState.timeLeft <= 30) {
                    timerDisplay.style.color = '#f39c12';
                }
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        function endGame() {
            clearInterval(gameState.gameTimer);
            showResults();
            showScreen('resultsScreen');
        }

        function showResults() {
            document.getElementById('finalScore').textContent = gameState.correctWords.length;
            document.getElementById('correctResultCount').textContent = gameState.correctWords.length;
            document.getElementById('skipResultCount').textContent = gameState.skippedWords.length;
            
            // Display correct words
            const correctList = document.getElementById('correctWordsList');
            correctList.innerHTML = '';
            gameState.correctWords.forEach(word => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-item';
                wordDiv.innerHTML = `
                    <div>
                        <div class="word-main">${word.word}</div>
                        <div class="word-trans">${word.translation}</div>
                    </div>
                `;
                correctList.appendChild(wordDiv);
            });
            
            // Display skipped words
            const skippedList = document.getElementById('skippedWordsList');
            skippedList.innerHTML = '';
            gameState.skippedWords.forEach(word => {
                const wordDiv = document.createElement('div');
                wordDiv.className = 'word-item';
                wordDiv.innerHTML = `
                    <div>
                        <div class="word-main">${word.word}</div>
                        <div class="word-trans">${word.translation}</div>
                    </div>
                `;
                skippedList.appendChild(wordDiv);
            });
        }

        // Swipe handling - optimized for landscape
        function setupSwipeHandlers() {
            const gameCard = document.getElementById('gameCard');
            let startY = 0;
            let startTime = 0;
            let isDragging = false;
            
            gameCard.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                startTime = Date.now();
                isDragging = false;
            }, { passive: true });
            
            gameCard.addEventListener('touchmove', (e) => {
                e.preventDefault(); // Prevent scrolling
                isDragging = true;
                
                const currentY = e.touches[0].clientY;
                const deltaY = startY - currentY;
                
                // Visual feedback during swipe
                if (Math.abs(deltaY) > 20) {
                    if (deltaY > 0) {
                        // Swiping up - Skip (red tint)
                        gameCard.style.background = `linear-gradient(135deg, #2c3e50 0%, rgba(231, 76, 60, 0.3) 100%)`;
                    } else {
                        // Swiping down - Correct (green tint)
                        gameCard.style.background = `linear-gradient(135deg, #2c3e50 0%, rgba(39, 174, 96, 0.3) 100%)`;
                    }
                } else {
                    gameCard.style.background = '#2c3e50';
                }
            }, { passive: false });
            
            gameCard.addEventListener('touchend', (e) => {
                const endY = e.changedTouches[0].clientY;
                const endTime = Date.now();
                const deltaY = startY - endY;
                const deltaTime = endTime - startTime;
                
                // Reset background
                gameCard.style.background = '#2c3e50';
                
                // Only consider swipes that are fast enough and long enough
                if (isDragging && Math.abs(deltaY) > 80 && deltaTime < 800) {
                    if (deltaY > 0) {
                        // Swipe up - Skip
                        skipWord();
                    } else {
                        // Swipe down - Correct
                        correctWord();
                    }
                }
                
                isDragging = false;
            }, { passive: true });
        }

        function correctWord() {
            const currentWord = gameState.currentWords[gameState.currentWordIndex];
            gameState.correctWords.push(currentWord);
            
            // Visual feedback
            const gameCard = document.getElementById('gameCard');
            gameCard.classList.add('correct');
            setTimeout(() => {
                gameCard.classList.remove('correct');
                nextWord();
            }, 600);
        }

        function skipWord() {
            const currentWord = gameState.currentWords[gameState.currentWordIndex];
            gameState.skippedWords.push(currentWord);
            
            // Visual feedback
            const gameCard = document.getElementById('gameCard');
            gameCard.classList.add('skip');
            setTimeout(() => {
                gameCard.classList.remove('skip');
                nextWord();
            }, 600);
        }

        function nextWord() {
            gameState.currentWordIndex++;
            displayCurrentWord();
        }

        // Exit game function
        function exitGame() {
            const shouldExit = confirm('確定要退出遊戲嗎？\nAre you sure you want to exit the game?');
            if (shouldExit) {
                if (gameState.gameTimer) {
                    clearInterval(gameState.gameTimer);
                    gameState.gameTimer = null;
                }
                // Reset timer display
                document.getElementById('gameTimer').style.color = '#e74c3c';
                document.getElementById('gameTimer').style.animation = 'none';
                showScreen('setupScreen');
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    
function requestFullScreen() {
  const el = document.documentElement;
  if (el.requestFullscreen) el.requestFullscreen();
  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
  else if (el.mozRequestFullScreen) el.mozRequestFullScreen();
  else if (el.msRequestFullscreen) el.msRequestFullscreen();
}
</script>
</body>
</html>
